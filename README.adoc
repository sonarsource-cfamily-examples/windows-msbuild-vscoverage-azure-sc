= C++ example project scanned on SonarCloud with code coverage using Azure Pipelines
// URIs:
:uri-qg-status: https://sonarcloud.io/dashboard?id=sonarsource-cfamily-examples_windows-msbuild-vscoverage-azure-sc
:img-qg-status: https://sonarcloud.io/api/project_badges/measure?project=sonarsource-cfamily-examples_windows-msbuild-vscoverage-azure-sc&metric=alert_status
:uri-build-status: https://dev.azure.com/sonarsource-cfamily-examples/windows-msbuild-vscoverage-azure-sc/_build/latest?definitionId=2
:img-build-status: https://dev.azure.com/sonarsource-cfamily-examples/windows-msbuild-vscoverage-azure-sc/_apis/build/status/sonarsource-cfamily-examples.windows-msbuild-vscoverage-azure-sc

image:{img-build-status}[Build Status, link={uri-build-status}]
image:{img-qg-status}[Quality Gate Status,link={uri-qg-status}]

*This project is analysed on https://sonarcloud.io/dashboard?id=sonarsource-cfamily-examples_windows-vscoverage-msbuild-azure-sc[SonarCloud]!*

:note-caption: :information_source:
NOTE: This simple example ignores https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#analysis-cache[analysis cache] and https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#parallel-code-scan[multithreaded execution] both of which can boost analysis significantly.

It is very easy to analyze a C, C++ and Objective-C project on SonarCloud with code coverage https://docs.sonarcloud.io/getting-started/azure-devops/[using Azure DevOps]:

. Create a `sonar-project.properties` file to store your configuration
. Install SonarCloud extension for your organization:
.. Open Organization settings (in the bottom left corner of organization view)
.. Open "Extensions" page (in the General category)
.. Press "Browse marketplace" and find "SonarCloud"
.. Select your organization and click "Install"
. Add the SonarCloud connection to your project:
.. Open Project settings (in the bottom left corner)
.. Open "Service connections" page (in the Pipelines category)
.. Press "New connection" and select the "SonarCloud"
.. Fill in the `SONAR_TOKEN`
.. Name your connection `SonarCloud` (to reference it later in `azure-pipelines.yml`)
. In your `azure-pipelines.yml` file:
.. Add the `SonarCloudPrepare` task and configure it:
* Specify the `SonarCloud Service Endpoint` as `SonarCloud` - the connection you created earlier
* Choose your `organization`
* Choose "Use standalone scanner" (`scannerMode: 'CLI'`)
* Choose "Store configuration with my source code (sonar-project.properties)" (`configMode: 'file'`)
* Initialize the extra property `sonar.cfamily.vscoveragexml.reportsPath` with the path that will contain your XML coverage report
.. Add a task to download the https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#analysis-steps-using-build-wrapper[Build Wrapper]
.. Wrap your compilation with the Build Wrapper
.. Add a `VSTest` task to launch your tests. Be sure to enable code coverage and to convert the result file into an XML file
.. Add the `SonarCloudAnalyze` task

You can take a look at the link:sonar-project.properties[sonar-project.properties] and link:azure-pipelines.yml[azure-pipelines.yml] to see it in practice.

= Documentation

- https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/[Documentation of the C, C++ and Objective-C plugin and its Build Wrapper]
- https://docs.sonarcloud.io/getting-started/azure-devops/[Documentation of using SonarCloud with Azure DevOps]
- https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#analysis-cache[Configuring C, C++ and Objective-C analysis cache]
- https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#parallel-code-scan[Configuring multithreaded execution]
- https://docs.sonarcloud.io/advanced-setup/languages/c-c-objective-c/#analysis-steps-using-compilation-database[Using compilation database (compile_commands.json)]

= Windows\MSBuild

A build of the https://github.com/sonarsource-cfamily-examples/code[code repository] on Windows platform using MSBuild build system.

To build the code run:
----
msbuild sonar_scanner_example.vcxproj
----

= Code Description

An example of a flawed C++ code. The https://github.com/sonarsource-cfamily-examples/code[code repository] is meant to be compiled with different build systems using different CI pipelines on Linux, MacOS, and Windows.

The https://github.com/sonarsource-cfamily-examples/code[code repository] is forked into other repositories in https://github.com/sonarsource-cfamily-examples[this collection] to add a specific build system, platform, and CI.
The downstream repositories are analyzed either with https://www.sonarqube.org/[SonarQube] or https://sonarcloud.io/[SonarCloud].

You can find examples for:

* https://github.com/sonarsource-cfamily-examples?q=linux[Linux]
* https://github.com/sonarsource-cfamily-examples?q=macos[MacOS]
* https://github.com/sonarsource-cfamily-examples?q=windows[Windows]

Using the following build systems:

* https://github.com/sonarsource-cfamily-examples?q=cmake[CMake]
* https://github.com/sonarsource-cfamily-examples?q=autotools[GNU Autotools]
* https://github.com/sonarsource-cfamily-examples?q=xcode[Xcode]
* https://github.com/sonarsource-cfamily-examples?q=msbuild[MSBuild]

Running on the following CI services:

* https://github.com/sonarsource-cfamily-examples?q=azure[Azure DevOps]
* https://github.com/sonarsource-cfamily-examples?q=gh-actions[GitHub Actions]
* https://github.com/sonarsource-cfamily-examples?q=travis[Travis]
* https://github.com/sonarsource-cfamily-examples?q=jenkins[Jenkins]
* https://github.com/sonarsource-cfamily-examples?q=gitlab[GitLab CI]
* https://github.com/sonarsource-cfamily-examples?q=bitbucket[BitBucket Pipelines]

Configured for analysis on:

* https://github.com/sonarsource-cfamily-examples?q=-sq[SonarQube]
* https://github.com/sonarsource-cfamily-examples?q=-sc[SonarCloud]


See link:./examples-structure.adoc[examples-structure.adoc] for a description of the structure of https://github.com/sonarsource-cfamily-examples[this GitHub organization] and the relations between its different repositories.
